<!DOCTYPE html>
<html lang="en">
{% load static %} <!-- This line is required to use the static template tag -->

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>drOidworks</title>
	<style>
		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			text-align: left;
			padding: 50px;
			background-color: lightskyblue;
			color: #333;
		}

		a {
			display: inline-block;
			margin: 10px;
			padding: 10px 20px;
			color: white;
			background-color: #FF6347;
			text-decoration: none;
			font-size: 10px;
			border-radius: 5px;
			transition: background-color 0.3s ease;
		}

		a:hover {
			background-color: #8B008B;
		}

		/* Chatbox style */
		.chatbox {
			position: fixed;
			bottom: 20px;
			left: 20px; /* Changed from right to left */
			width: 500px;
			height: 700px; /* Add this line to set the height of the chatbox */
			background-color: #fff;
			border-radius: 10px;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			overflow: hidden;
		}

		.chatbox-header {
			background-color: #4169E1;
			font-size: 24px; /* Adjust the size as needed */
			color: #FFFFFF; /* Change this to your desired font color */
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Add this line to give a shadow effect to the text */
			padding: 15px;
			font-weight: bold;
			border-bottom: 1px solid #ccc;
		}

		.chatbox-header .header-top {
			display: flex;
			align-items: center;
			justify-content: center; /* Center the header text */
			position: relative; /* Add this line to position the flicker circle */
		}

		.chatbox-header .header-top::after {
			content: '';
			display: inline-block;
			width: 16px; /* Diameter of the circle */
			height: 16px; /* Diameter of the circle */
			background-color: limegreen; /* Bright green color */
			border-radius: 50%; /* Makes the element a circle */
			margin-left: 10px; /* Space between the text and the circle */
			animation: flicker 1.5s infinite; /* Add animation for flickering effect */
		}

		@keyframes flicker {
			0%, 100% { opacity: 1; }
			50% { opacity: 0.5; }
		}

		.chatbox-header .header-bottom {
			display: flex;
			justify-content: flex-end; /* Align the date and time to the right */
			font-size: 10px;
			color: rgb(235, 235, 187); /* Set your desired font color here */
		}

		.chatbox-body {
			height: 525px;
			padding: 10px;
			overflow-y: auto;
			background-color: #f9f9f9;
		}

		.chatbox-footer {
			padding: 10px;
			border-top: 1px solid #ccc;
			display: flex;
			align-items: center;
		}

		.chatbox-footer input[type="text"] {
			flex: 1;
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 5px;
			margin-right: 10px;
		}

		.chatbox-footer button {
			padding: 10px 15px;
			background-color: #28a745; /* Changed to green */
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			transition: background-color 0.3s ease;
		}

		.chatbox-footer button:hover {
			background-color: #218838; /* Darker green on hover */
		}

		/* Message container style */
		.message-container {
			display: flex;
			align-items: center;
			margin-bottom: 10px;
		}

		.message-container img {
			width: 30px;
			height: 30px;
			margin-right: 10px;
			border-radius: 50%;
		}

		.message-text {
			background-color: #e9e9e9;
			padding: 10px;
			border-radius: 10px;
		}

		/* Guest message container style */
		.guest-message-container {
			justify-content: flex-end; /* Aligns the message to the right */
		}

		.guest-message-container img {
			margin-right: 0; /* Removes the margin on the right side of the image */
			margin-left: 10px; /* Adds margin on the left side to space from the text */
		}

		.guest-message-container .message-text {
			background-color: #d1e7fd; /* Optionally change the background color for guest messages */
			font-size: 14px; /* Set the font size for guest messages */
		}

		.agent-message-container .message-text {
			background-color: #e9e9e9; /* Optionally change the background color for agent messages */
			font-size: 14px; /* Set the font size for agent messages */
		}

		/* Style for the date-time span */
		.date-time {
			font-size: 12px;
			display: block;
			margin-top: 5px;
		}
	</style>

	<link rel="icon" href="{% static 'chatbot/favicon.png' %}" type="image/x-icon">
</head>
<body>
	<h1> </h1>

	<!-- Chatbox -->
	<div class="chatbox">
		<div class="chatbox-header">
			<div class="header-top">
				OPE droid
			</div>
			<div class="header-bottom">
				<span id="date-time" class="date-time"></span>
			</div>
		</div>
		<div class="chatbox-body" id="chatbox-body">
			<!-- Initial agent message -->
			<div class="message-container agent-message-container">
				<img src="{% static 'chatbot/droid.png' %}" alt="Agent">
				<div class="message-text">What's my next task, please? ðŸ˜Š</div>
			</div>
		</div>
		<div class="chatbox-footer">
			<input type="text" id="chat-message-input" placeholder="Type a message...">
			<button id="send-button">Ask now</button>
		</div>
	</div>

	<script>
		const chatSocket = new WebSocket('ws://' + window.location.host + '/ws/chat/');

		// List of possible agent messages
		const agentMessages = [
			"Hello",
			"How may I help you?",
			"Wonderful to have you",
			"Keep visiting us",
			"I am glad",
			"Please stay in for a long time"
		];

		chatSocket.onmessage = function(e) {
			const data = JSON.parse(e.data);
			const message = data.message;

			const messageContainer = document.createElement('div');
			messageContainer.classList.add('message-container', 'agent-message-container');

			const imgElement = document.createElement('img');
			imgElement.src = "{% static 'chatbot/droid.png' %}";
			messageContainer.appendChild(imgElement);

			const messageText = document.createElement('div');
			messageText.classList.add('message-text');
			messageText.innerHTML = message;
			messageContainer.appendChild(messageText);

			document.getElementById('chatbox-body').appendChild(messageContainer);

			// Scroll to the bottom
			scrollToBottom();
		};

		chatSocket.onclose = function(e) {
			console.error('Chat socket closed unexpectedly');
		};

		// Send message when the send button is clicked
		document.getElementById('send-button').onclick = function(e) {
			sendMessage();
		};

		// Send message when Enter key is pressed
		document.getElementById('chat-message-input').onkeydown = function(e) {
			if (e.key === 'Enter') {
				e.preventDefault();  // Prevent the default action (form submission)
				sendMessage();
			}
		};

		function sendMessage() {
			const messageInputDom = document.getElementById('chat-message-input');
			const message = messageInputDom.value;
			const formattedMessage = "  " + message;

			// Send the message with the "Me" prefix
			chatSocket.send(JSON.stringify({'message': formattedMessage}));

			// Display the user's message in the chatbox
			const messageContainer = document.createElement('div');
			messageContainer.classList.add('message-container', 'guest-message-container');

			const imgElement = document.createElement('img');
			imgElement.src = "{% static 'chatbot/guest.png' %}";
			messageContainer.appendChild(imgElement);

			const messageText = document.createElement('div');
			messageText.classList.add('message-text');
			messageText.innerHTML = formattedMessage; // Use innerHTML to render HTML tags
			messageContainer.appendChild(messageText);

			document.getElementById('chatbox-body').appendChild(messageContainer);

			// Clear the input field
			messageInputDom.value = '';

			// Scroll to the bottom
			scrollToBottom();

			// Agent's response after a slight delay (to simulate typing)
			setTimeout(() => {
				const randomIndex = Math.floor(Math.random() * agentMessages.length);
				const agentMessage = "   " + agentMessages[randomIndex];

				// Display the agent's response in the chatbox
				const agentMessageContainer = document.createElement('div');
				agentMessageContainer.classList.add('message-container');

				const agentImgElement = document.createElement('img');
				agentImgElement.src = "{% static 'chatbot/droid.png' %}";
				agentMessageContainer.appendChild(agentImgElement);

				const agentMessageText = document.createElement('div');
				agentMessageText.classList.add('message-text');
				agentMessageText.innerHTML = agentMessage; // Use innerHTML to render HTML tags
				agentMessageContainer.appendChild(agentMessageText);

				document.getElementById('chatbox-body').appendChild(agentMessageContainer);

				// Scroll to the bottom
				scrollToBottom();
			}, 1000);  // 1 second delay
		}

		function scrollToBottom() {
			const chatboxBody = document.getElementById('chatbox-body');
			chatboxBody.scrollTop = chatboxBody.scrollHeight;
		}

		// Function to format date and time
		function formatDateTime(date) {
			const options = { month: 'short', day: '2-digit', year: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
			return date.toLocaleString('en-US', options);
		}

		// Set the current date and time in the header
		function updateDateTime() {
			const now = new Date();
			const formattedDateTime = formatDateTime(now);
			document.getElementById('date-time').innerText = formattedDateTime;
		}

		// Update the date and time every second
		setInterval(updateDateTime, 1000);

		// Initial call to set the date and time immediately
		updateDateTime();
	</script>
</body>
</html>